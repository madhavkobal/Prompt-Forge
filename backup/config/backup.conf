################################################################################
# PromptForge Backup Configuration
################################################################################
#
# This file contains configuration for the backup and restore scripts.
# Copy this file to /etc/promptforge/backup.conf or ~/.promptforge/backup.conf
# for system-wide or user-specific configuration.
#
# All values can be overridden by environment variables.
#
################################################################################

################################################################################
# Backup Directories
################################################################################

# Main backup directory (where all backups are stored)
BACKUP_DIR="/var/backups/promptforge"

# Backup subdirectories
BACKUP_FULL_DIR="${BACKUP_DIR}/full"
BACKUP_DB_DIR="${BACKUP_DIR}/database"
BACKUP_CONFIG_DIR="${BACKUP_DIR}/configs"

################################################################################
# Database Configuration
################################################################################

# Database connection settings
DB_HOST="localhost"
DB_PORT="5432"
DB_NAME="promptforge"
DB_USER="promptforge"
# DB_PASS should be set via environment variable for security

# PostgreSQL superuser (for database operations)
POSTGRES_USER="postgres"
# POSTGRES_PASSWORD should be set via environment variable

################################################################################
# Backup Schedule
################################################################################

# Backup frequency (used by cron jobs)
# Full backup: weekly on Sunday at 2 AM
# Database backup: daily at 1 AM
# Log backup: daily at 3 AM

# Backup timing (for logging purposes)
FULL_BACKUP_DAY="Sunday"
FULL_BACKUP_TIME="02:00"
DB_BACKUP_TIME="01:00"

################################################################################
# Retention Policy
################################################################################

# Number of days to keep backups
RETENTION_FULL=30        # Keep full backups for 30 days
RETENTION_DB=30          # Keep database backups for 30 days
RETENTION_LOGS=7         # Keep log backups for 7 days

# Number of backups to keep (alternative to time-based retention)
KEEP_FULL_BACKUPS=4      # Keep last 4 full backups (weekly = 1 month)
KEEP_DB_BACKUPS=30       # Keep last 30 database backups (daily = 1 month)

################################################################################
# Compression
################################################################################

# Compression level (0-9, where 9 is maximum compression)
COMPRESS_LEVEL=6         # Default: 6 (good balance of speed and size)

# Compression for database backups (pg_dump --compress)
DB_COMPRESS_LEVEL=6

################################################################################
# Encryption
################################################################################

# Enable/disable encryption (true/false)
ENCRYPT_BACKUPS=true

# GPG recipient for encryption
GPG_RECIPIENT="admin@promptforge.io"

# GPG key ID (optional, if you want to use a specific key)
# GPG_KEY_ID="1234567890ABCDEF"

################################################################################
# Off-site Backup
################################################################################

# Enable/disable off-site backup (true/false)
OFFSITE_BACKUP=true

# Remote server for off-site backup
REMOTE_USER="backup"
REMOTE_HOST="backup.example.com"
REMOTE_PATH="/backups/promptforge"

# SSH key for authentication (optional)
# SSH_KEY="/root/.ssh/backup_id_rsa"

# Rsync options
RSYNC_OPTS="-avz --delete-after --backup --backup-dir=.deleted"

################################################################################
# S3-Compatible Storage (Alternative to SSH/rsync)
################################################################################

# Enable S3 backup (true/false)
S3_BACKUP=false

# S3 configuration
S3_ENDPOINT="https://s3.amazonaws.com"
S3_BUCKET="promptforge-backups"
S3_REGION="us-east-1"
# S3_ACCESS_KEY and S3_SECRET_KEY should be set via environment variables

# S3 storage class (STANDARD, STANDARD_IA, GLACIER, etc.)
S3_STORAGE_CLASS="STANDARD_IA"

################################################################################
# Docker Configuration
################################################################################

# Docker compose file to use
DOCKER_COMPOSE_FILE="docker-compose.yml"

# Docker volumes to backup (space-separated list)
# Leave empty to backup all volumes
DOCKER_VOLUMES="promptforge_postgres_data promptforge_redis_data promptforge_uploads"

# Docker networks to backup configuration (space-separated list)
DOCKER_NETWORKS="promptforge_default"

################################################################################
# Backup Verification
################################################################################

# Enable automatic verification after backup (true/false)
AUTO_VERIFY=true

# Perform test restore during verification (true/false)
# Note: This creates a temporary database, so it requires more resources
TEST_RESTORE=false

################################################################################
# Notifications
################################################################################

# Enable email notifications (true/false)
EMAIL_NOTIFICATIONS=true

# Email addresses for notifications (space-separated)
NOTIFY_EMAIL="admin@promptforge.io ops@promptforge.io"

# Email for critical alerts only
NOTIFY_CRITICAL_EMAIL="admin@promptforge.io"

# SMTP configuration
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USERNAME=""
# SMTP_PASSWORD should be set via environment variable

# Slack webhook for notifications (optional)
# SLACK_WEBHOOK_URL="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

################################################################################
# Logging
################################################################################

# Log directory
LOG_DIR="/var/log/promptforge/backup"

# Log file rotation
LOG_MAX_SIZE="100M"      # Maximum log file size
LOG_MAX_FILES=10         # Number of rotated log files to keep

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL="INFO"

################################################################################
# Advanced Options
################################################################################

# Parallel compression threads (for pigz)
COMPRESS_THREADS=4

# Database dump jobs (for pg_dump --jobs)
DB_DUMP_JOBS=4

# Backup timeout (in seconds)
BACKUP_TIMEOUT=3600      # 1 hour

# Lock file to prevent concurrent backups
LOCK_FILE="/var/run/promptforge-backup.lock"

# Temporary directory for backup operations
TEMP_DIR="/tmp/promptforge-backup"

################################################################################
# Application-Specific Paths
################################################################################

# PromptForge installation directory
PROMPTFORGE_DIR="/opt/promptforge"

# Configuration files to backup
CONFIG_FILES=(
    ".env"
    ".env.monitoring"
    "docker-compose.yml"
    "docker-compose.ha.yml"
    "docker-compose.monitoring.yml"
)

# Directories to backup
BACKUP_DIRS=(
    "nginx"
    "ha"
    "monitoring"
    "database/config"
    "ssl"
)

# Application data directories
APP_DATA_DIRS=(
    "logs"
    "uploads"
    "media"
    "backend/static"
)

# Files to exclude from backup (glob patterns)
EXCLUDE_PATTERNS=(
    "*.log"
    "*.tmp"
    "*.cache"
    "__pycache__"
    "node_modules"
    ".git"
)

################################################################################
# Point-in-Time Recovery (PITR)
################################################################################

# Enable WAL archiving for PITR (true/false)
ENABLE_WAL_ARCHIVING=true

# WAL archive directory
WAL_ARCHIVE_DIR="${BACKUP_DIR}/wal_archive"

# WAL retention (in days)
WAL_RETENTION=7

################################################################################
# Disaster Recovery
################################################################################

# Recovery Time Objective (RTO) in hours
RTO=4

# Recovery Point Objective (RPO) in hours
RPO=24

# DR site configuration (for disaster recovery drills)
DR_SITE_HOST=""
DR_SITE_USER=""
DR_SITE_PATH=""

################################################################################
# Testing and Validation
################################################################################

# Automated testing schedule
# Run backup tests: monthly on first Sunday at 4 AM
TEST_SCHEDULE="monthly"
TEST_DAY="first-sunday"
TEST_TIME="04:00"

# DR drill schedule
# Quarterly disaster recovery drills
DR_DRILL_SCHEDULE="quarterly"

# Backup validation checks
VALIDATE_CHECKSUMS=true
VALIDATE_RESTORE=false       # Full restore test (resource intensive)
VALIDATE_DB_STRUCTURE=true

################################################################################
# Performance Tuning
################################################################################

# I/O nice level (0-7, where 7 is lowest priority)
IONICE_LEVEL=5

# CPU nice level (-20 to 19, where 19 is lowest priority)
NICE_LEVEL=10

# Bandwidth limit for rsync (in KB/s, 0 = unlimited)
BANDWIDTH_LIMIT=0

################################################################################
# End of Configuration
################################################################################
