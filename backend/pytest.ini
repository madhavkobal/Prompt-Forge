[pytest]
# Pytest configuration for PromptForge backend tests

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests

# Exclude patterns
norecursedirs = scripts .git __pycache__ venv env .venv htmlcov

# Minimum version
minversion = 7.0

# Command line options applied by default
addopts =
    # Verbose output
    -v
    # Show local variables in tracebacks
    -l
    # Show summary of all test outcomes
    -ra
    # Enable strict markers
    --strict-markers
    # Coverage reporting
    --cov=app
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    --cov-report=json
    # Fail if coverage is below threshold
    # Current: ~40% (auth/models tests implemented, new security/monitoring features added)
    # TODO: Increase to 60% after adding tests for:
    #   - security_middleware.py, api_keys.py, metrics.py, health.py
    #   - gemini_service.py (mocked), auth_service.py
    # Goal: 80% (once all feature tests are added)
    --cov-fail-under=39
    # Show warnings
    -W default
    # Disable warnings for specific modules
    -W ignore::DeprecationWarning
    # Show 10 slowest tests
    --durations=10
    # Output format
    --tb=short

# Markers for categorizing tests
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, require DB)
    slow: Slow tests (can be skipped for quick runs)
    api: API endpoint tests
    database: Database tests
    auth: Authentication tests
    gemini: Tests that interact with Gemini API (mocked)
    skip_ci: Skip in CI environment

# Asyncio configuration
asyncio_mode = auto

# Coverage configuration
[coverage:run]
source = app
omit =
    */tests/*
    */migrations/*
    */scripts/*
    */__pycache__/*
    */site-packages/*
    */venv/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

exclude_lines =
    # Standard pragma
    pragma: no cover
    # Debug code
    def __repr__
    # Abstract methods
    raise NotImplementedError
    # Type checking
    if TYPE_CHECKING:
    # Main guards
    if __name__ == .__main__.:
